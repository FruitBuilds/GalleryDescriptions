using GalleryDescriptions.Managers;
using HarmonyLib;
using Nick;
using UnityEngine;
using System.Linq;
using System.Reflection;

namespace GalleryDescriptions.Patches
{
    [HarmonyPatch(typeof(GalleryScreen), nameof(GalleryScreen.SetSlotPortrait))]
    static class GalleryScreen_Thumbnail
    {
        static BindingFlags bindingFlags = BindingFlags.NonPublic | BindingFlags.Instance;
        static FieldInfo seekTex = typeof(SetSlotPortrait).GetField("seekTex", bindingFlags);

        static void Postfix(GallerySlot gallerySlot, SetSlotPortrait ___galleryPicture)
        {
            var id = gallerySlot.galleryPictureData.PicturePath.Split('/').Last();
            if (GalleryManager.TryGetThumbnail(id, out Texture2D texture))
            {
                ___thumbnail.rawImage.texture = texture;
                seekTex.SetValue(___galleryPicture, false);
                ___thumbnail.rawImage.enabled = true;
            }
        }
    }
}
